
; PIC16F877A Configuration Bit Settings

; Assembly source line config statements

#include "p16f877a.inc"

; CONFIG
; __config 0xFF32
 __CONFIG _FOSC_HS & _WDTE_OFF & _PWRTE_ON & _BOREN_OFF & _LVP_OFF & _CPD_OFF & _WRT_OFF & _CP_OFF

CBLOCK 0X30
cuenta1
cuenta2
ENDC
 
	ORG	0
	GOTO	INICIO
INICIO
	BSF	STATUS,RP0
	CLRF	TRISD; SALIDA
	CLRF	TRISC; SALIDA
	BSF	TRISA,0; RA0 ENTRADA
	BSF	ADCON1,3
	BSF	ADCON1,2
	BSF	ADCON1,1
	BCF	ADCON1,0; 1110 -> RA0 AN0 = ANALOGO
	BSF	ADCON1,6; FOSC/64
	BCF	ADCON1,7; JUSTIFICACION IZQ
	BCF	STATUS,RP0
	BSF	ADCON0,7
	BCF	ADCON0,6; FOSC/64
	BCF	ADCON0,5
	BCF	ADCON0,4
	BCF	ADCON0,3; CANAL AN0
	MOVLW   B'00111110' ;80% MSB
	MOVWF	CCPR1L
	BSF	CCP1CON,5 ; 1 LSB 80%
	BCF	CCP1CON,4 ; 0
	BSF	T2CON,1 ;16 PRESCALER
	BCF	T2CON,0
	BSF	CCP1CON,3; 1100 PWM
	BSF	CCP1CON,2
	BCF	CCP1CON,1
	BCF	CCP1CON,0
	BSF	T2CON,2; TMR2 ON
	BSF	ADCON0,0; ADC ONc
	CLRF	PORTD
	CLRF	PORTC
	BSF	PORTD,1
	BCF	PORTD,2
START
	BSF	ADCON0,2; GO/DONE -> 1
ADC	BTFSC	ADCON0,2
	GOTO	ADC
	MOVF	CCP1CON,W; 0010 1100
	ANDLW	B'00001100'; 0000 1100
	MOVWF	cuenta2
	MOVF	ADRESH,W
	MOVWF	CCPR1L
	BSF	STATUS,RP0
	MOVF	ADRESL,W
	BCF	STATUS,RP0
	;MOVLW	B'11000000'
	MOVWF	cuenta1; 11000000
	RRF	cuenta1,F
	RRF	cuenta1,F; 00110000
	MOVF	cuenta1,W
	ADDWF	cuenta2,F; 
	MOVF	cuenta2,W
	MOVWF	CCP1CON
;	MOVWF	PORTC
	CALL	Retardo_20ms 
;	CALL	Retardo_20ms 
;	CALL	Retardo_20ms 
;	CALL	Retardo_20ms 
;	CALL	Retardo_20ms 
	GOTO	START
	
include "Retardo.inc"	
	
	END